<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/screen/window.xsd"
        caption="msg://incidentsEdit.caption"
        focusComponent="form"
        messagesPack="com.company.suraltyn.web.screens.incidents">

    <data>
        <instance id="incidentsDc"
                  class="com.company.suraltyn.entity.Incidents">
            <view extends="_local">
                <property name="departmentHead" view="_minimal"/>
                <property name="executor" view="_minimal"/>
                <property name="source" view="_minimal"/>
                <property name="files" view="_minimal"/>
            </view>
        </instance>
a
        <collection id="filesDc"
                    class="com.company.suraltyn.entity.FileEntity">
            <loader>
                <query>
                    <![CDATA[
                        select f
                        from suraltyn$Incidents i
                        join i.files f
                        where i = :container.incidentsDc
                    ]]>
                </query>
            </loader>
        </collection>
    </data>

    <layout spacing="true" expand="scrollBox">
        <scrollBox id="scrollBox" spacing="true" width="100%">

            <form id="form" dataContainer="incidentsDc" width="100%">
                <column width="350px">
                    <textField id="numberField" property="number" editable="false"/>
                    <textField id="nameField" property="name"/>
                    <textField id="initiatorField" property="initiator" editable="false"/>
                    <textField id="authorityNameField" property="authorityName"/>
                    <textField id="checkNameField" property="checkName"/>
                    <dateField id="checkDateField" property="checkDate"/>
                    <textField id="violationNameField" property="violationName"/>
                    <textField id="violationCountField" property="violationCount"/>

                    <pickerField id="departmentHeadField" property="departmentHead">
                        <actions>
                            <action id="lookupDepartmentHead" type="picker_lookup"/>
                            <action id="clearDepartmentHead" type="picker_clear"/>
                        </actions>
                    </pickerField>

                    <pickerField id="executorField" property="executor">
                        <actions>
                            <action id="lookupExecutor" type="picker_lookup"/>
                            <action id="clearExecutor" type="picker_clear"/>
                        </actions>
                    </pickerField>

                    <dateField id="deadlineField" property="deadline"/>
                    <textField id="measuresCountField" property="measuresCount"/>
                    <textArea id="penaltiesResultField" property="penaltiesResult" rows="4"/>
                    <textField id="penaltySumField" property="penaltySum"/>
                    <textField id="reimbursementField" property="reimbursement"/>

                    <pickerField id="sourceField" property="source">
                        <actions>
                            <action id="lookupSource" type="picker_lookup"/>
                            <action id="clearSource" type="picker_clear"/>
                        </actions>
                    </pickerField>

                    <textArea id="commentField" property="comment" rows="4"/>
                </column>
            </form>

            <groupBox id="filesBox"
                      caption="msg://com.company.suraltyn.entity/Incidents.files"
                      width="100%">
                <vbox spacing="true">
                    <hbox spacing="true" align="MIDDLE_LEFT">
                        <fileUploadField id="fileUploadField"
                                         accept="*/*"
                                         width="300px"
                                         uploadButtonCaption="Загрузить файл"
                                         clearButtonCaption="Очистить"/>
                        <button id="removeFileBtn"
                                caption="Удалить выбранные файлы"/>
                    </hbox>

                    <dataGrid id="filesDataGrid"
                              dataContainer="filesDc"
                              width="100%"
                              height="200px"
                              selectionMode="MULTI">
                        <actions>
                            <action id="removeFiles" type="remove"/>
                        </actions>

                        <columns>
                            <column id="fileName" caption="Имя файла" property="fileName"/>
                            <column id="fileType" caption="Тип" property="fileType"/>
                            <column id="fileSize" caption="Размер" property="fileSize"/>
                            <column id="createDate" caption="Дата создания" property="fileDescriptor.createDate"/>
                        </columns>
                    </dataGrid>
                </vbox>
            </groupBox>
        </scrollBox>

        <hbox id="detailActions" spacing="true">
            <button id="commitAndCloseBtn" action="windowCommitAndClose"/>
            <button id="closeBtn" action="windowClose"/>
        </hbox>
    </layout>
</window>
